<!doctype html>
<html>
<head>
<meta charset="UTF-8">

<title>SonicBase - Tutorial - Cluster Deploy</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Tutorial on how to get started with SonicBase as a cluster. The tutorial primarily shows you how to use SonicBase via the administration client.">
    <link href="../css/singlePageTemplate.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="../javascript/main.js"></script>

    <link rel="stylesheet" href="../css/tomorrow-night-bright.css">
    <script src="../javascript/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109032274-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-109032274-1');
        ga('require', 'displayfeatures');
    </script>
</head>


<body>
<div class="container">
    <header id="myHeader">
        <div class="mobile">
            <a href="../index.html">
                <h4 class="logo">SonicBase™</h4>
            </a>
        </div>

        <div class="desktop">
            <a href="../index.html">
                <img style="margin-top:3px" src="../images/logo-white.gif" width="50px"/><h4 class="logo">SonicBase™</h4>
            </a>
        <nav>
            <ul>
                <li><a href="../index.html">HOME</a></li>
                <li> <a href="../documentation.html">DOCUMENTATION</a></li>
                <li><a href="../contact.html">CONTACT</a></li>
            </ul>
        </nav>
        </div>
    </header>

    <script>
        if (isFramed()) {
            document.getElementById("myHeader").style.display = "none";
        }
    </script>

    <div class="main-page-text">

<h1>Tutorial - Cluster Deploy</h1>
<br/>
In this tutorial we will walk you through the process of creating a cluster, deploying to it, starting the cluster and running commands on it.<br/>
<br/>
<h2>Download The Software</h2>
        <div class="mylink">
Go to the <a href="javascript:parent.window.location.href='../downloads.html'">downloads</a> section of the SonicBase website and download the latest version.
        </div>
<h2>Unpack Package</h2>
        <div style="margin-left: 2em;">

            <lu>
                <li>
        Linux/Mac: Type "tar -xzf sonicbase-&lt;version&gt;.tgz" in the parent directory where you want the software to go. A directory
        named "sonicbase" will be created.<br/>
                </li>
                <li>
                    Windows: Unzip the file sonicbase-&lt;version&gt;.zip in the parent directory where you want the software to go. A directory
                    named "sonicbase" will be created.
                </li>
            </lu>
        </div>
<h2>Create a Config File</h2>
        In the sonicbase/config directory is the config file "config-1-local.json". Copy this file to "config-test.json".
<h2>Set Paths In The Config</h2>
        <div class="mylink">
Edit the "config-test.json" file in the sonicbase/config directory. See <a href="config.html?framed=true">Configuration Files</a>.
            Set the "dataDirectory" to the location you want the database files to be stored on your servers.
            Set the "installDirectory" to where you want the installation files
            to be located on your servers.<br/>
        </div>
        <br/>
        Note on Windows you will need to escape the backslashes so the value can be stored in the json file.<br/>
On Windows the directory may look like "c:\\\\db-data". On linux it may look like "/mnt/db-data". On linux and mac
you also have the option of prefixing your path with "$HOME" to specify the home directory. This option is not available on Windows.
        <h2>Configure Servers</h2>
      <div class="mylink">
        Set the addresses and ports of each of your servers in the config file. If you have a pro license or 30-day trial you
        may configure multiple servers as replicas. Below is an example of configuring two shards and two replicas. A shard is a subset
        of the data located on server and its replicas. See <a href="shards-and-replicas.html?framed=true">Shards and Replicas</a>.
      </div>
        <h3>Example With 2 Shards and 2 Replicas</h3>
        <pre class="java"><code>
"shards" :
[
  {
    "replicas" :
    [
      {
        "publicAddress" : "18.232.5.217",
        "privateAddress" : "10.0.0.205",
        "port" : 9010
      },
      {
        "publicAddress" : "10.0.0.141",
        "privateAddress" : "10.0.0.141",
        "port" : 9010
      }
    ]
  },
  {
    "replicas" :
    [
      {
        "publicAddress" : "10.0.0.42",
        "privateAddress" : "10.0.0.42",
        "port" : 9010
      },
      {
        "publicAddress" : "10.0.0.252",
        "privateAddress" : "10.0.0.252",
        "port" : 9010
      }
    ]
  }
]</code></pre>

        <h3>Example With 2 Shards, 1 Replica</h3>
        <pre class="java"><code>
"shards" :
[
  {
    "replicas" :
    [
      {
        "publicAddress" : "18.232.5.217",
        "privateAddress" : "10.0.0.205",
        "port" : 9010
      }
    ]
  },
  {
    "replicas" :
    [
      {
        "publicAddress" : "10.0.0.42",
        "privateAddress" : "10.0.0.42",
        "port" : 9010
      }
    ]
  }
]</code></pre>
        If you want to deploy from your laptop to the cluster, the first server listed needs a public address that can be accessed
        from you laptop.
<h2>Start Admin Client</h2>
Change to the sonicbase/bin directory and type "./cli" for MacOS and Linux and "./cli.bat" for cygwin and "cli.bat" for Windows.
        This will start the SonicBase admin client.
<h2>Start License Server</h2>
      <div class="mylink">
      If you have more that one replica configured you will need to <a href="../downloads.html?framed=true">purchase licenses</a> and start the license server. For more details see <a href="license-server.html?framed=true">License Server</a>.
      </div>
<h2>Use Cluster</h2>
In the client, type:<br/>
&nbsp;&nbsp;use cluster test<br/><br/>
        <div class="mylink">
This will allow you to use the "test" cluster. All subsequent operations will be performed on the "test" cluster.
            You can create other clusters by adding a config file for each cluster
in the sonicbase/config directory. The name of the file must be "config-&lt;cluster name&gt;.json". See
        <a href="config.html?framed=true">Configuration Files</a> for more detail.
        </div>
        <h2>Passwordless SSH</h2>
        If your servers aren't local, for Linux and Mac you need to setup passwordless ssh between all your servers
         before taking the next steps. You also need passwordless ssh between your laptop and the first server configured
        in your cluster.
        <h2>PowerShell for Windows</h2>
        <div class="mylink">
        To administer your cluster on Windows you need to install PowerShell. For more detais, see <a href="setup-windows.html?framed=true">Setup Windows</a>.
        </div>
        <h2>Deploy Cluster</h2>
        In the client, type:<br/>
        &nbsp;&nbsp;deploy cluster<br/><br/>
        If all your servers are local, you do not need to deploy the cluster. Note that this command is not available
        in Windows. In Windows you need to manually copy the local install directory to each server in the location
        specified by "installDirectory" in the config file.
        <h2>Switch to Server for Administration</h2>
        If any of your servers are configured with a private address(no accessible via you laptop) you will need to
        administer your cluster from a server located in your private network. To do this, ssh to your server of choice
        and start the admin client. The following commands are run from the admin client on this server.
<h2>Start Cluster</h2>
In the client, type:<br/>
&nbsp;&nbsp;start cluster<br/><br/>
This will start the cluster on the servers specified in the config file.
<h2>Create Database</h2>
In the client, type:<br/>
&nbsp;&nbsp;create database db<br/><br/>
This will create the database named "db".
<h2>Create Table</h2>
In the client, type:<br/>
&nbsp;&nbsp;create table persons (name VARCHAR, age INTEGER, ssn VARCHAR, PRIMARY KEY (ssn))<br/>
<h2>Insert Record</h2>
In the client, type:<br/>
&nbsp;&nbsp;insert into persons (name, age, ssn) VALUES ('bob', 22, '555-66-7777')<br/>
<h2>Read Record</h2>
In the client, type:<br/>
&nbsp;&nbsp;select * from persons<br/>
<br/>
You should see the inserted record displayed in the client.
<h2>Access From JDBC Driver</h2>
        <div class="mylink">
        Include the SonicBase jdbc driver in your application. The jar is located in the "lib" directory of the install directory.
        It is named "sonicbase-&lt;version&gt;.jar". For more details, see <a href="jdbc-driver.html?framed=true">JDBC Driver</a>.<br/>
        </div>
        <br/>
        Create and run the following class:<br/>
<br/>
<pre class="java"><code>
package foo;

public class Tutorial {
  public static void main(String[] args) throws ClassNotFoundException, SQLException {
    Class.forName("com.sonicbase.jdbcdriver.Driver");
    try (Connection conn = DriverManager.getConnection("jdbc:sonicbase:127.0.0.1:9010/db");
         PreparedStatement stmt = conn.prepareStatement("select * from persons");
         ResultSet rs = stmt.executeQuery()) {
      rs.next();
      System.out.println(rs.getString("name") + " " + rs.getInt("age") + " " + rs.getString("ssn"));
    }
  }
}</code></pre>
<h2>Stop Cluster</h2>
In the client, type:<br/>
&nbsp;&nbsp;stop cluster
</div>
</div>
</body>
</html>
